<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Projects</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">

</head>
<body>
<div th:replace="~{sidebar :: sidebar}"></div>
<div class="content">
    <div class="content-header">
        <h1>My Projects</h1>
        <button id="openBtn" class="button add-btn">Thêm dự án</button>

        <div id="overlay" class="overlay">
            <div class="popup">
                <h3>Thêm dự án mới</h3>
                <div class="form-container">

                    <form th:action="@{'/projects/new'}" method="post" th:object="${project}" class="project-form">

                        <div class="form-group">
                            <label for="name">Tên dự án:</label>
                            <input type="text" id="name" name="name" th:field="*{name}" placeholder="Nhập tên dự án" required>
                            <span class="error" th:errors="*{name}"></span>
                        </div>

                        <div class="form-group">
                            <label for="description">Mô tả:</label>
                            <textarea id="description" name="description" th:field="*{description}" placeholder="Nhập mô tả ngắn" rows="5"></textarea>
                        </div>

                        <div class="form-actions">
                            <button id="closeBtn" class="button cancel-btn">Hủy</button>
                            <button type="submit" class="button add-btn">Thêm</button>
                        </div>
                    </form>
            </div>
            </div>
        </div>

        <script>
            const overlay = document.getElementById("overlay");
            document.getElementById("openBtn").onclick = () => overlay.classList.add("show");
            document.getElementById("closeBtn").onclick = () => overlay.classList.remove("show");
        </script>
    </div>

    <!-- Nếu chưa có dự án -->
    <div th:if="${projects.isEmpty()}" class="alert">
        Bạn chưa có dự án nào.
    </div>

    <!-- Danh sách dự án -->
    <table th:if="${!projects.isEmpty()}" class="project-table">
        <thead>
        <tr>
            <th>Tên dự án</th>
            <th>Mô tả</th>
            <th>Ngày tạo</th>
            <th>Hành động</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="p : ${projects}" th:onclick="'window.location.href=\'/projects/' + ${p.id} + '\';'">
            <td th:text="${p.name}">Tên dự án</td>
            <td th:text="${p.description}">Mô tả dự án</td>
            <td th:text="${#temporals.format(p.created, 'dd/MM/yyyy HH:mm')}">31/10/2025</td>
            <td>
                <form th:action="@{'/projects/delete/' + ${p.id}}" method="post" onsubmit="return confirmDelete(event)">
                    <button type="submit" class="button delete-btn" onclick="event.stopPropagation()">Xóa</button>
                </form>

                <script>
                    function confirmDelete(event) {
                        const ok = confirm("Bạn có chắc muốn xóa project này? Bạn có thể mất toàn bộ các task liên quan!");
                        if (!ok) {
                            event.preventDefault();
                            window.location.href = "/projects";
                            return false;
                        }
                        return true;
                    }
                </script>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>